<div
  class="flex flex-col h-screen max-h-screen justify-between bg-white text-slate-600"
>
  <div class="h-14 flex items-center px-6 border-b border-[#E1E1E1]">
    <div class="flex flex-col items-start gap-1">
      <h3 class="font-light text-xl text-slate-600">InsightBot</h3>
    </div>
  </div>
  <div class="flex-1 overflow-y-auto p-4 space-y-4 scroll-smooth min-h-0">
    @for (msg of chatService.messages(); track $index) {
      <div
        [class]="
          msg.sender === 'user' ? 'flex justify-end' : 'flex justify-start'
        "
      >
        <div
          [class]="
            msg.sender === 'user'
              ? 'bg-[#0078d3] text-white rounded rounded-tr-none'
              : 'text-slate-600 border border-[#E1E1E1] rounded rounded-tl-none text-slate-600'
          "
          class="max-w-[88%] px-3 py-2 text-[13px] leading-normal whitespace-pre-wrap"
        >
          {{ msg.text }}
        </div>
      </div>
    }

    @if (chatService.loading()) {
      <div class="flex justify-start">
        <div
          class="text-slate-600 border border-[#E1E1E1] rounded rounded-tl-none px-3 py-2 border border-[#E1E1E1] space-x-1 flex"
        >
          <div
            class="w-1.5 h-1.5 bg-[#999999] rounded-full animate-bounce"
          ></div>
          <div
            class="w-1.5 h-1.5 bg-[#999999] rounded-full animate-bounce [animation-delay:-0.15s]"
          ></div>
          <div
            class="w-1.5 h-1.5 bg-[#999999] rounded-full animate-bounce [animation-delay:-0.3s]"
          ></div>
        </div>
      </div>
    }
  </div>

  <div class="p-4 border-t border-[#E1E1E1] flex-none">
    @if (chatService.messages().length < 15) {
      <div class="relative group flex items-end">
        <textarea
          #chatInput
          rows="5"
          (keydown.enter)="
            $event.preventDefault();
            chatService.sendMessage(chatInput.value);
            chatInput.value = ''
          "
          placeholder="Ask a question..."
          class="w-full border border-[#DCDCDC] rounded py-2.5 pl-3 pr-10 text-[13px] outline-none focus:border-[#25408F] transition-all placeholder:text-[#999999] resize-none overflow-y-auto max-h-[120px] leading-[1.5]"
        ></textarea>

        <button
          (click)="
            chatService.sendMessage(chatInput.value); chatInput.value = ''
          "
          class="absolute right-2 bottom-2.5 text-[#25408F] hover:scale-110 transition-transform"
        >
          <svg fill="currentColor" class="w-5 h-5" viewBox="0 0 24 24">
            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
          </svg>
        </button>
      </div>
      <p
        class="text-[10px] text-[#999999] mt-2 text-center uppercase tracking-tighter"
      >
        {{ chatService.messages().length }} of 15 interactions
      </p>
    } @else {
      <div
        class="bg-amber-50 border border-amber-200 text-amber-800 text-[11px] p-2 text-center rounded font-bold"
      >
        CONVERSATION LIMIT REACHED
      </div>
    }
  </div>
</div>
